<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>6 HMM states | Medaka behaviour pilot study</title>
<meta name="author" content="Ian Brettell">
<meta name="description" content="Here we show how using a higher number of states in the HMM appeared to optimise the balance between the ability to discern differences between lines and model overfitting, yet produced...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="6 HMM states | Medaka behaviour pilot study">
<meta property="og:type" content="book">
<meta property="og:description" content="Here we show how using a higher number of states in the HMM appeared to optimise the balance between the ability to discern differences between lines and model overfitting, yet produced...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="6 HMM states | Medaka behaviour pilot study">
<meta name="twitter:description" content="Here we show how using a higher number of states in the HMM appeared to optimise the balance between the ability to discern differences between lines and model overfitting, yet produced...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/vembedr-0.1.5/css/vembedr.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.22/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><style>
    #content {
        font-size: 0.9rem;
    }
    </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Medaka behaviour pilot study</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> About</a></li>
<li><a class="" href="experimental-setup.html"><span class="header-section-number">2</span> Experimental setup</a></li>
<li><a class="" href="data-collection.html"><span class="header-section-number">3</span> Data collection</a></li>
<li><a class="" href="effect-of-covariates.html"><span class="header-section-number">4</span> Effect of covariates</a></li>
<li><a class="" href="param-optim.html"><span class="header-section-number">5</span> HMM parameter optimisation</a></li>
<li><a class="active" href="hmm-states.html"><span class="header-section-number">6</span> HMM states</a></li>
<li><a class="" href="model-proportion-of-time-spent-in-hmm-states.html"><span class="header-section-number">7</span> Model proportion of time spent in HMM states</a></li>
<li><a class="" href="time-dependence-of-hmm-states-dge.html"><span class="header-section-number">8</span> Time dependence of HMM states (DGE)</a></li>
<li><a class="" href="time-dependence-of-hmm-states-sge.html"><span class="header-section-number">9</span> Time dependence of HMM states (SGE)</a></li>
<li><a class="" href="sge-co-occupancy.html"><span class="header-section-number">10</span> SGE co-occupancy</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/brettellebi/pilot_paper">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="hmm-states" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> HMM states<a class="anchor" aria-label="anchor" href="#hmm-states"><i class="fas fa-link"></i></a>
</h1>
<p>Here we show how using a higher number of states in the HMM appeared to optimise the balance between the ability to discern differences between lines and model overfitting, yet produced asymmetries in the classified states that would impede biological interpretation.</p>
<p>The HMMs were trained on distance and angle variables. <strong>Figure <a href="hmm-states.html#fig:polar-example">6.1</a></strong> depicts how the distance and angle of travel of the movements are represented in the polar plots.</p>

<div class="figure">
<span style="display:block;" id="fig:polar-example"></span>
<img src="figs/misc/dist_angle_polar_example.png" alt="Distance (in log10(pixels)) and angle of travel between a time interval of 0.2 seconds from points B → C for distance, and points A → B → C for angle. Each point represents the distance and angle at point C, and A → B is aligned vertically along the 0-180° radial axis. The figure shows only an illustrative 10,000 points, randomly selected from the full dataset. States are sorted in ascending order by mean distance." width="100%"><p class="caption">
Figure 6.1: Distance (in log<sub>10</sub>(pixels)) and angle of travel between a time interval of 0.2 seconds from points B → C for distance, and points A → B → C for angle. Each point represents the distance and angle at point C, and A → B is aligned vertically along the 0-180° radial axis. The figure shows only an illustrative 10,000 points, randomly selected from the full dataset. States are sorted in ascending order by mean distance.
</p>
</div>
<div id="setup-2" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Setup<a class="anchor" aria-label="anchor" href="#setup-2"><i class="fas fa-link"></i></a>
</h2>
<div id="load-libraries-2" class="section level3" number="6.1.1">
<h3>
<span class="header-section-number">6.1.1</span> Load libraries<a class="anchor" aria-label="anchor" href="#load-libraries-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/karthik/wesanderson">wesanderson</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/rstatix/">rstatix</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Variables included in HMM</span>
<span class="va">VARIABLES</span> <span class="op">=</span> <span class="st">"dist_angle"</span>

<span class="co"># Create line recode vector</span>
<span class="va">line_vec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"iCab"</span>, <span class="st">"HdrR"</span>, <span class="st">"HNI"</span>, <span class="st">"Kaga"</span>, <span class="st">"HO5"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">line_vec</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"icab"</span>, <span class="st">"hdr"</span>, <span class="st">"hni"</span>, <span class="st">"kaga"</span>, <span class="st">"ho5"</span><span class="op">)</span>

<span class="co"># Function for plot dimensions</span>
<span class="va">get_wid_hei</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">N_STATES</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">N_STATES</span> <span class="op">==</span> <span class="fl">14</span><span class="op">)</span><span class="op">{</span>
    <span class="va">POL_ALL_WID</span> <span class="op">=</span> <span class="fl">12</span>
    <span class="va">POL_ALL_HEI</span> <span class="op">=</span> <span class="fl">7</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="va">POL_ALL_WID</span> <span class="op">=</span> <span class="fl">7.5</span>
    <span class="va">POL_ALL_HEI</span> <span class="op">=</span> <span class="fl">10</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">POL_ALL_WID</span>, <span class="va">POL_ALL_HEI</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Function for number of rows in plot</span>
<span class="va">get_n_rows</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">N_STATES</span><span class="op">)</span><span class="op">{</span> 
  <span class="kw">if</span> <span class="op">(</span><span class="va">N_STATES</span> <span class="op">==</span> <span class="fl">15</span><span class="op">)</span><span class="op">{</span>
    <span class="va">N_ROWS</span> <span class="op">=</span> <span class="fl">5</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">N_STATES</span> <span class="op">==</span> <span class="fl">12</span> <span class="op">|</span> <span class="va">N_STATES</span> <span class="op">==</span> <span class="fl">16</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">N_ROWS</span> <span class="op">=</span> <span class="fl">4</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">N_STATES</span> <span class="op">==</span> <span class="fl">17</span> <span class="op">|</span> <span class="va">N_STATES</span> <span class="op">==</span> <span class="fl">18</span><span class="op">)</span><span class="op">{</span>
    <span class="va">N_ROWS</span> <span class="op">=</span> <span class="fl">6</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">N_STATES</span> <span class="op">==</span> <span class="fl">14</span><span class="op">)</span><span class="op">{</span>
    <span class="va">N_ROWS</span> <span class="op">=</span> <span class="fl">2</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">N_ROWS</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
<div id="unfavourable-asymmetry-with-higher-numbers-of-states" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Unfavourable asymmetry with higher numbers of states<a class="anchor" aria-label="anchor" href="#unfavourable-asymmetry-with-higher-numbers-of-states"><i class="fas fa-link"></i></a>
</h2>
<p>Based a visualisation of the polar plots for the each state-number/interval combination, we excluded combinations with 15 or more states due to an asymmetry across states that would create difficulties for interpreting their biological meaning. Here we show an example of the combination of 16 states and a 0.05-second interval, where states 1 and 3 are split asymmetrically (<strong>Figure <a href="#fig:polar-asym"><strong>??</strong></a></strong>).</p>
<div id="states-0.05-second-interval" class="section level3" number="6.2.1">
<h3>
<span class="header-section-number">6.2.1</span> 16 states; 0.05 second interval<a class="anchor" aria-label="anchor" href="#states-0.05-second-interval"><i class="fas fa-link"></i></a>
</h3>
<div id="variables" class="section level4" number="6.2.1.1">
<h4>
<span class="header-section-number">6.2.1.1</span> Variables<a class="anchor" aria-label="anchor" href="#variables"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">N_STATES</span> <span class="op">=</span> <span class="fl">16</span>
<span class="va">INTERVAL</span> <span class="op">=</span> <span class="fl">0.05</span>
<span class="va">IN</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"/hps/nobackup/birney/users/ian/pilot/hmm_out"</span>,
               <span class="va">INTERVAL</span>,
               <span class="va">VARIABLES</span>,
               <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">N_STATES</span>, <span class="st">".csv"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
               <span class="op">)</span>

<span class="va">N_ROWS</span> <span class="op">=</span> <span class="fu">get_n_rows</span><span class="op">(</span><span class="va">N_STATES</span><span class="op">)</span>
<span class="va">POL_DIMS</span> <span class="op">=</span> <span class="fu">get_wid_hei</span><span class="op">(</span><span class="va">N_STATES</span><span class="op">)</span>
<span class="va">POLAR_ALL_DGE</span> <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"book/figs/paper_final"</span>,
                           <span class="va">INTERVAL</span>,
                           <span class="va">VARIABLES</span>,
                           <span class="va">N_STATES</span>,
                           <span class="st">"polar_all_dge.png"</span><span class="op">)</span></code></pre></div>
</div>
<div id="read-data-and-process-1" class="section level4" number="6.2.1.2">
<h4>
<span class="header-section-number">6.2.1.2</span> Read data and process<a class="anchor" aria-label="anchor" href="#read-data-and-process-1"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">IN</span><span class="op">)</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># recode angle to sit between 0 and 360</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>angle_recode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">angle</span> <span class="op">&lt;</span> <span class="fl">0</span>,
                                      <span class="fl">180</span> <span class="op">+</span> <span class="op">(</span><span class="fl">180</span> <span class="op">+</span> <span class="va">angle</span><span class="op">)</span>,
                                      <span class="va">angle</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Rows: 14649781 Columns: 15</span>
<span class="co">#&gt; ── Column specification ────────────────────────────────────</span>
<span class="co">#&gt; Delimiter: ","</span>
<span class="co">#&gt; chr (6): assay, ref_fish, test_fish, tank_side, quadrant...</span>
<span class="co">#&gt; dbl (9): date, time, frame, seconds, x, y, distance, ang...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span>

<span class="co"># Recode states by mean distance</span>

<span class="va">rank_df</span> <span class="op">=</span> <span class="va">df</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mean_dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># rank</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">mean_dist</span><span class="op">)</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>

<span class="va">recode_vec</span> <span class="op">=</span> <span class="va">rank_df</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">rank</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">recode_vec</span><span class="op">)</span> <span class="op">=</span> <span class="va">rank_df</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span>

<span class="co"># Recode `state`</span>

<span class="va">df</span> <span class="op">=</span> <span class="va">df</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state_recode <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">state</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">recode_vec</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="plot-2" class="section level4" number="6.2.1.3">
<h4>
<span class="header-section-number">6.2.1.3</span> Plot<a class="anchor" aria-label="anchor" href="#plot-2"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polar_all_dge</span> <span class="op">=</span> <span class="va">df</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># select random sample of 1e5 rows</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1e5</span><span class="op">)</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># factorise `state_recode`</span>
  <span class="co">#dplyr::mutate(state_recode = factor(state_recode, levels = recode_vec)) %&gt;% </span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">angle_recode</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span>, colour <span class="op">=</span> <span class="va">state_recode</span><span class="op">)</span>,
             alpha <span class="op">=</span> <span class="fl">0.3</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html">coord_polar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">state_recode</span>, nrow <span class="op">=</span> <span class="va">N_ROWS</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">#theme_dark(base_size = 8) +</span>
  <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html">theme_cowplot</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span>, <span class="fl">180</span>, <span class="fl">270</span><span class="op">)</span>,
                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span>, <span class="fl">180</span>, <span class="fl">270</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"angle of travel"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">log</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">(</span><span class="st">"distance travelled in pixels"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Save</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">POLAR_ALL_DGE</span>,
       <span class="va">polar_all_dge</span>,
       device <span class="op">=</span> <span class="st">"png"</span>,
       width <span class="op">=</span> <span class="va">POL_DIMS</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
       height <span class="op">=</span> <span class="va">POL_DIMS</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,
       units <span class="op">=</span> <span class="st">"in"</span>,
       dpi <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></code></pre></div>

<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="va">POLAR_ALL_DGE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="figs/paper_final/0.05/dist_angle/16/polar_all_dge.png" width="100%"></div>
</div>
</div>
</div>
<div id="best-optimisation-with-state-symmetry" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Best optimisation with state symmetry<a class="anchor" aria-label="anchor" href="#best-optimisation-with-state-symmetry"><i class="fas fa-link"></i></a>
</h2>
<div id="states-0.08-second-interval" class="section level3" number="6.3.1">
<h3>
<span class="header-section-number">6.3.1</span> 14 states; 0.08 second interval<a class="anchor" aria-label="anchor" href="#states-0.08-second-interval"><i class="fas fa-link"></i></a>
</h3>
<p>For the downstream analysis we selected the combination of 14 states with a 0.08-second interval between time points (<strong>Figure <a href="hmm-states.html#fig:polar-example">6.1</a></strong>), because out of the remaining combinations it appeared to optimally balance the level of overfitting and detection of differences between lines – see Chapter <a href="param-optim.html#param-optim">5</a>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">N_STATES</span> <span class="op">=</span> <span class="fl">14</span>
<span class="va">INTERVAL</span> <span class="op">=</span> <span class="fl">0.08</span>
<span class="va">IN</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"/hps/nobackup/birney/users/ian/pilot/hmm_out"</span>,
               <span class="va">INTERVAL</span>,
               <span class="va">VARIABLES</span>,
               <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">N_STATES</span>, <span class="st">".csv"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
               <span class="op">)</span>

<span class="va">N_ROWS</span> <span class="op">=</span> <span class="fu">get_n_rows</span><span class="op">(</span><span class="va">N_STATES</span><span class="op">)</span>
<span class="va">POL_DIMS</span> <span class="op">=</span> <span class="fu">get_wid_hei</span><span class="op">(</span><span class="va">N_STATES</span><span class="op">)</span>
<span class="va">POLAR_ALL_DGE</span> <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"book/figs/paper_final"</span>,
                           <span class="va">INTERVAL</span>,
                           <span class="va">VARIABLES</span>,
                           <span class="va">N_STATES</span>,
                           <span class="st">"polar_all_dge.png"</span><span class="op">)</span></code></pre></div>
<div id="read-data-and-process-2" class="section level4" number="6.3.1.1">
<h4>
<span class="header-section-number">6.3.1.1</span> Read data and process<a class="anchor" aria-label="anchor" href="#read-data-and-process-2"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">IN</span><span class="op">)</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># recode angle to sit between 0 and 360</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>angle_recode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">angle</span> <span class="op">&lt;</span> <span class="fl">0</span>,
                                      <span class="fl">180</span> <span class="op">+</span> <span class="op">(</span><span class="fl">180</span> <span class="op">+</span> <span class="va">angle</span><span class="op">)</span>,
                                      <span class="va">angle</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Rows: 9152328 Columns: 15</span>
<span class="co">#&gt; ── Column specification ────────────────────────────────────</span>
<span class="co">#&gt; Delimiter: ","</span>
<span class="co">#&gt; chr (6): assay, ref_fish, test_fish, tank_side, quadrant...</span>
<span class="co">#&gt; dbl (9): date, time, frame, seconds, x, y, distance, ang...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span>

<span class="co"># Recode states by mean distance</span>

<span class="va">rank_df</span> <span class="op">=</span> <span class="va">df</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mean_dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># rank</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">mean_dist</span><span class="op">)</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>

<span class="va">recode_vec</span> <span class="op">=</span> <span class="va">rank_df</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">rank</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">recode_vec</span><span class="op">)</span> <span class="op">=</span> <span class="va">rank_df</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span>

<span class="co"># Recode `state`</span>

<span class="va">df</span> <span class="op">=</span> <span class="va">df</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state_recode <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">state</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">recode_vec</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="plot-3" class="section level4" number="6.3.1.2">
<h4>
<span class="header-section-number">6.3.1.2</span> Plot<a class="anchor" aria-label="anchor" href="#plot-3"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polar_all_dge</span> <span class="op">=</span> <span class="va">df</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># select random sample of 1e5 rows</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1e5</span><span class="op">)</span> <span class="op"><a href="https://rpkgs.datanovia.com/rstatix/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">angle_recode</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span>, colour <span class="op">=</span> <span class="va">state_recode</span><span class="op">)</span>,
             alpha <span class="op">=</span> <span class="fl">0.3</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html">coord_polar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">state_recode</span>, nrow <span class="op">=</span> <span class="va">N_ROWS</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html">theme_cowplot</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span>, <span class="fl">180</span>, <span class="fl">270</span><span class="op">)</span>,
                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span>, <span class="fl">180</span>, <span class="fl">270</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"angle of travel"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">log</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">(</span><span class="st">"distance travelled in pixels"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Save</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">POLAR_ALL_DGE</span>,
       <span class="va">polar_all_dge</span>,
       device <span class="op">=</span> <span class="st">"png"</span>,
       width <span class="op">=</span> <span class="va">POL_DIMS</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
       height <span class="op">=</span> <span class="va">POL_DIMS</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,
       units <span class="op">=</span> <span class="st">"in"</span>,
       dpi <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></code></pre></div>

<div class="inline-figure"><img src="figs/paper_final/0.08/dist_angle/14/polar_all_dge.png" width="100%"></div>

</div>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="param-optim.html"><span class="header-section-number">5</span> HMM parameter optimisation</a></div>
<div class="next"><a href="model-proportion-of-time-spent-in-hmm-states.html"><span class="header-section-number">7</span> Model proportion of time spent in HMM states</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#hmm-states"><span class="header-section-number">6</span> HMM states</a></li>
<li>
<a class="nav-link" href="#setup-2"><span class="header-section-number">6.1</span> Setup</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#load-libraries-2"><span class="header-section-number">6.1.1</span> Load libraries</a></li></ul>
</li>
<li>
<a class="nav-link" href="#unfavourable-asymmetry-with-higher-numbers-of-states"><span class="header-section-number">6.2</span> Unfavourable asymmetry with higher numbers of states</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#states-0.05-second-interval"><span class="header-section-number">6.2.1</span> 16 states; 0.05 second interval</a></li></ul>
</li>
<li>
<a class="nav-link" href="#best-optimisation-with-state-symmetry"><span class="header-section-number">6.3</span> Best optimisation with state symmetry</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#states-0.08-second-interval"><span class="header-section-number">6.3.1</span> 14 states; 0.08 second interval</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/brettellebi/pilot_paper/blob/master/book/HMM_states.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/brettellebi/pilot_paper/edit/master/book/HMM_states.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Medaka behaviour pilot study</strong>" was written by Ian Brettell. It was last built on 2022-07-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
