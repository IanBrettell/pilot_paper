[{"path":"index.html","id":"about","chapter":"1 About","heading":"1 About","text":"notebook sets selection analyses pilot study medaka bold-shy behaviours using 5 established inbred strains (iCab, HdrR, Kaga, HNI, HO5).","code":""},{"path":"index.html","id":"videos","chapter":"1 About","heading":"1.1 Videos","text":"videos showcase example data HMM movement classifications 5 lines. Set quality HD viewing.video displays one 10-minute open field assay 4 pairs fish, sped 10x.Top left raw video labelled fishes.Top right paths fish.Bottom left paths test fish (either iCab, HdrR, Kaga, HNI, HO5), coloured HMM state.Bottom right paths reference iCab fish, coloured HMM state.","code":""},{"path":"index.html","id":"icab-southern-japan","chapter":"1 About","heading":"1.1.1 iCab (southern Japan)","text":"","code":"\nvembedr::embed_url(\"https://www.youtube.com/watch?v=ldd7vI7J3JE\")"},{"path":"index.html","id":"hdrr-southern-japan","chapter":"1 About","heading":"1.1.2 HdrR (southern Japan)","text":"","code":""},{"path":"index.html","id":"kaga-northern-japan","chapter":"1 About","heading":"1.1.3 Kaga (northern Japan)","text":"","code":""},{"path":"index.html","id":"hni-northern-japan","chapter":"1 About","heading":"1.1.4 HNI (northern Japan)","text":"","code":""},{"path":"index.html","id":"ho5-northern-japan","chapter":"1 About","heading":"1.1.5 HO5 (northern Japan)","text":"","code":""},{"path":"experimental-setup.html","id":"experimental-setup","chapter":"2 Experimental setup","heading":"2 Experimental setup","text":"behavioural assay 20 minutes long, comprising two consecutively-run 10-minute components: ) ‘open field’ component, fishes introduced test tank left swim around freely; b) ‘novel object’ component, small black plastic cylinder added tank beginning second 10-minute period, fishes left swim around freely. assay run pairs fish. used female fish avoid confounding aggressive interactions males, mating behaviours males females. increase throughput assay, constructed test tank divided four quadrants barriers, allowing us run assay four pairs fish time. addition, used two test tanks situated side--side, run assay 8 pairs concurrently. experimental setup used shown 2.1.\nFigure 2.1: : Experimental setup, two test boxes side--side (denoted “L” left “R” right). test box contains one test tank, separated removable barriers quadrants, allowing simultaneous assay four pairs fish per test tank. interior box ambiently illuminated LED lights, camera suspended centre test tank record videos. B: Four pairs fishes test tank labelled quadrants (, II, III, IV) lines (iCab HdrR). C: Paths iCab reference fish HdrR test fish video panel (B) 110 seconds.\n","code":""},{"path":"effect-of-covariates.html","id":"effect-of-covariates","chapter":"3 Effect of covariates","heading":"3 Effect of covariates","text":"","code":""},{"path":"effect-of-covariates.html","id":"setup","chapter":"3 Effect of covariates","heading":"3.1 Setup","text":"","code":""},{"path":"effect-of-covariates.html","id":"load-libraries","chapter":"3 Effect of covariates","heading":"3.1.1 Load libraries","text":"","code":"\nlibrary(tidyverse)\nlibrary(ggbeeswarm)\nlibrary(devtools)\nlibrary(cowplot)\nlibrary(ggpubr)"},{"path":"effect-of-covariates.html","id":"set-variables","chapter":"3 Effect of covariates","heading":"3.1.2 Set variables","text":"","code":"\nIN = \"/hps/nobackup/birney/users/ian/pilot/hmm_out/0.08/dist_angle/14.csv\"\nOUT_OF = \"book/figs/covariate_effects/0.08/dist_angle/14/covariate_effects_of.png\"\nOUT_NO = \"book/figs/covariate_effects/0.08/dist_angle/14/covariate_effects_no.png\"\nOUT_NOASSAY = \"book/figs/covariate_effects/0.08/dist_angle/14/covariate_effects_no-split-by-assay.png\""},{"path":"effect-of-covariates.html","id":"source-lighterdarker-functions","chapter":"3 Effect of covariates","heading":"3.1.3 Source lighter/darker functions","text":"","code":"\ndevtools::source_gist(\"c5015ee666cdf8d9f7e25fa3c8063c99\")\n#> ℹ Sourcing https://gist.githubusercontent.com/brettellebi/c5015ee666cdf8d9f7e25fa3c8063c99/raw/15832e2684e4c08a652eb82d4b559bea4e8994e4/karyoploteR_lighter_darker.R\n#> ℹ SHA-1 hash of file is 3d840ff655bd54f4b19517cf99ec4bd3640a30c5"},{"path":"effect-of-covariates.html","id":"read-and-process-data","chapter":"3 Effect of covariates","heading":"3.2 Read and process data","text":"","code":"\ndf = readr::read_csv(IN) \n#> Rows: 9152328 Columns: 15\n#> ── Column specification ────────────────────────────────────\n#> Delimiter: \",\"\n#> chr (6): assay, ref_fish, test_fish, tank_side, quadrant...\n#> dbl (9): date, time, frame, seconds, x, y, distance, ang...\n#> \n#> ℹ Use `spec()` to retrieve the full column specification for this data.\n#> ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\ndf_control = df %>% \n  # Filter for only iCabs paired with iCabs\n  dplyr::filter(test_fish == \"icab\") %>% \n  # Get individual\n  tidyr::unite(date, time, quadrant, fish,\n               col = \"indiv\", \n               remove = F) %>% \n  # Group by assay and individual to get mean speed\n  dplyr::group_by(assay, date, time, quadrant, tank_side, indiv) %>% \n  # Calculate mean speed\n  dplyr::summarise(mean_speed = mean(distance)) %>% \n  dplyr::ungroup() %>% \n  # Make date a factor\n  dplyr::mutate(date = as.factor(date))\n#> `summarise()` has grouped output by 'assay', 'date',\n#> 'time', 'quadrant', 'tank_side'. You can override using the\n#> `.groups` argument."},{"path":"effect-of-covariates.html","id":"calculate-mean-speed-across-both-assays-for-each-individual","chapter":"3 Effect of covariates","heading":"3.2.1 Calculate mean speed across both assays for each individual","text":"","code":"\ndf_control_noassay = df %>% \n  # Filter for only iCabs paired with iCabs\n  dplyr::filter(test_fish == \"icab\") %>% \n  # Get individual\n  tidyr::unite(date, time, quadrant, fish,\n               col = \"indiv\", \n               remove = F) %>% \n  # Group by assay and individual to get mean speed\n  dplyr::group_by(date, time, quadrant, tank_side, indiv) %>% \n  # Calculate mean speed\n  dplyr::summarise(mean_speed = mean(distance)) %>% \n  dplyr::ungroup() %>% \n  # Make date a factor\n  dplyr::mutate(date = as.factor(date))\n#> `summarise()` has grouped output by 'date', 'time',\n#> 'quadrant', 'tank_side'. You can override using the\n#> `.groups` argument."},{"path":"effect-of-covariates.html","id":"anova","chapter":"3 Effect of covariates","heading":"3.3 ANOVA","text":"","code":""},{"path":"effect-of-covariates.html","id":"all-days","chapter":"3 Effect of covariates","heading":"3.3.1 All days","text":"","code":"\naov_df_noassay = df_control_noassay %>% \n  aov(mean_speed ~ date + time + quadrant + tank_side,\n      data = .) %>%\n  broom::tidy(.) %>% \n  rstatix::add_significance(p.col = \"p.value\") %>% \n  # reduce to 3 digits\n  dplyr::mutate(p.value = signif(p.value, digits = 3)) %>% \n  # paste p-value with significance\n  dplyr::mutate(p_final = dplyr::case_when(p.value.signif == \"ns\" ~ paste(\"p =\", p.value),\n                                           TRUE ~ paste(\"p =\", p.value, p.value.signif)))\n\nDT::datatable(aov_df_noassay)"},{"path":"effect-of-covariates.html","id":"excluding-the-first-day","chapter":"3 Effect of covariates","heading":"3.3.2 Excluding the first day","text":"","code":"\naov_df_noassay_nofirstday = df_control_noassay %>% \n  dplyr::filter(date != \"20190611\") %>% \n  aov(mean_speed ~ date + time + quadrant + tank_side,\n      data = .) %>%\n  broom::tidy(.) %>% \n  rstatix::add_significance(p.col = \"p.value\") %>% \n  # reduce to 3 digits\n  dplyr::mutate(p.value = signif(p.value, digits = 3)) %>% \n  # paste p-value with significance\n  dplyr::mutate(p_final = dplyr::case_when(p.value.signif == \"ns\" ~ paste(\"p =\", p.value),\n                                           TRUE ~ paste(\"p =\", p.value, p.value.signif)))\n\nDT::datatable(aov_df_noassay_nofirstday)"},{"path":"effect-of-covariates.html","id":"plot","chapter":"3 Effect of covariates","heading":"3.4 Plot","text":"","code":""},{"path":"effect-of-covariates.html","id":"set-height-to-plot-p-value","chapter":"3 Effect of covariates","heading":"3.4.1 Set height to plot p-value","text":"","code":"\nP_VAL_HEI = 4.7"},{"path":"effect-of-covariates.html","id":"date","chapter":"3 Effect of covariates","heading":"3.4.2 Date","text":"","code":"\ndate_pal = colorspace::sequential_hcl(length(unique(df_control_noassay$date)),\n                                      palette = \"OrYel\")\n\ndate_fig_noassay = df_control_noassay %>% \n  dplyr::mutate(date = factor(date, levels = sort(unique(date)))) %>% \n  #ggplot(aes(date, mean_speed, fill = date)) +\n  ggplot() +\n  geom_violin(aes(date, mean_speed, fill = date, colour = date)) +\n  geom_boxplot(aes(date, mean_speed, fill = date, colour = date),\n               width = 0.25) +\n  ggbeeswarm::geom_beeswarm(aes(date, mean_speed),\n                            colour = \"#3B1F2B\", alpha = 0.8) +\n  geom_text(data = aov_df_noassay %>% \n              dplyr::filter(term == \"date\"),\n            aes(x = \"20190611\", y = P_VAL_HEI, label = p_final)) +\n  #geom_text(x = \"20190611\", y = 3.15, label = paste(\"p =\", kw_date)) +\n  scale_fill_manual(values = date_pal) +\n  scale_colour_manual(values = darker(date_pal, amount = 100)) +\n  cowplot::theme_cowplot() +\n  guides(fill = \"none\",\n         colour = \"none\") +\n  ylab(\"mean speed\") "},{"path":"effect-of-covariates.html","id":"time","chapter":"3 Effect of covariates","heading":"3.4.3 Time","text":"","code":"\ntime_pal = colorspace::sequential_hcl(length(unique(df_control_noassay$time)),\n                                      palette = \"ag_GrnYl\")\n\ntime_fig_noassay = df_control_noassay %>% \n  dplyr::mutate(time = factor(time)) %>% \n  ggplot() +\n  geom_violin(aes(time, mean_speed, fill = time, colour = time)) +\n  geom_boxplot(aes(time, mean_speed, fill = time, colour = time),\n               width = 0.15) +\n  ggbeeswarm::geom_beeswarm(aes(time, mean_speed),\n                            colour = \"#3B1F2B\", alpha = 0.8) +\n  geom_text(data = aov_df_noassay %>% \n              dplyr::filter(term == \"time\"),\n            aes(x = \"952\", y = P_VAL_HEI, label = p_final)) +\n  scale_fill_manual(values = time_pal) +\n  scale_colour_manual(values = darker(time_pal, amount = 100)) +\n  cowplot::theme_cowplot() +\n  guides(colour = \"none\",\n         fill = \"none\") +\n  ylab(\"mean speed\") "},{"path":"effect-of-covariates.html","id":"quadrant","chapter":"3 Effect of covariates","heading":"3.4.4 Quadrant","text":"","code":"\nquad_pal = scales::hue_pal()(4)\n\nquad_fig_noassay = df_control_noassay %>% \n  dplyr::mutate(quadrant = dplyr::recode(quadrant,\n                                         \"q1\" = \"I\",\n                                         \"q2\" = \"II\",\n                                         \"q3\" = \"III\",\n                                         \"q4\" = \"IV\")) %>% \n  dplyr::mutate(quadrant = factor(quadrant, levels = c(\"I\", \"II\", \"III\", \"IV\"))) %>% \n  #ggplot(aes(quadrant, mean_speed, fill = quadrant)) +\n  ggplot() +\n  geom_violin(aes(quadrant, mean_speed, fill = quadrant, colour = quadrant)) +\n  geom_boxplot(aes(quadrant, mean_speed, fill = quadrant, colour = quadrant),\n               width = 0.3) +\n  ggbeeswarm::geom_beeswarm(aes(quadrant, mean_speed),\n                            colour = \"#3B1F2B\", alpha = 0.8) +\n  geom_text(data = aov_df_noassay %>% \n              dplyr::filter(term == \"quadrant\"),\n            aes(x = \"I\", y = P_VAL_HEI, label = p_final)) +\n  scale_fill_manual(values = quad_pal) +\n  scale_colour_manual(values = darker(quad_pal, amount = 100)) +\n  cowplot::theme_cowplot() +\n  guides(colour = \"none\",\n         fill = \"none\") +\n  ylab(\"mean speed\") "},{"path":"effect-of-covariates.html","id":"tank-side","chapter":"3 Effect of covariates","heading":"3.4.5 Tank side","text":"","code":"\ntank_pal = colorspace::diverging_hcl(length(unique(df_control_noassay$tank_side)),\n                                     palette = \"Red-Green\")\n\ntank_fig_noassay = df_control_noassay %>% \n  dplyr::mutate(tank_side = factor(tank_side, levels = c(\"L\", \"R\"))) %>% \n  #ggplot(aes(tank_side, mean_speed, fill = tank_side)) +]\n  ggplot() +\n  geom_violin(aes(tank_side, mean_speed, fill = tank_side, colour = tank_side)) +\n  geom_boxplot(aes(tank_side, mean_speed, fill = tank_side, colour = tank_side),\n               width = 0.25) +\n  ggbeeswarm::geom_beeswarm(aes(tank_side, mean_speed),\n                            colour = \"#3B1F2B\", alpha = 0.8) +  \n  geom_text(data = aov_df_noassay %>% \n              dplyr::filter(term == \"tank_side\"),\n            aes(x = \"L\", y = P_VAL_HEI, label = p_final)) +\n  scale_fill_manual(values = tank_pal) +\n  scale_colour_manual(values = darker(tank_pal, amount = 100)) +\n  cowplot::theme_cowplot() +\n  guides(colour = \"none\",\n         fill = \"none\") +\n  ylab(\"mean speed\") +\n  xlab(\"tank side\")"},{"path":"effect-of-covariates.html","id":"compile","chapter":"3 Effect of covariates","heading":"3.4.6 Compile","text":"","code":"\nfinal_noassay = cowplot::ggdraw() +\n  cowplot::draw_plot(date_fig_noassay,\n                     x = 0, y = 0.5,\n                     width = 0.55, height = 0.5) + \n  cowplot::draw_plot(quad_fig_noassay,\n                     x = 0.55, y = 0.5,\n                     width = 0.45, height = 0.5) + \n  cowplot::draw_plot(time_fig_noassay,\n                     x = 0, y = 0,\n                     width = 0.6, height = 0.5) + \n  cowplot::draw_plot(tank_fig_noassay,\n                     x = 0.6, y = 0,\n                     width = 0.4, height = 0.5) +\n  cowplot::draw_plot_label(c(\"A\", \"B\", \"C\", \"D\"),\n                           x = c(0, 0.55, 0, 0.6),\n                           y = c(1, 1, 0.5, 0.5))\n# Save\nggsave(here::here(OUT_NOASSAY),\n       final_noassay,\n       device = \"png\",\n       width = 15,\n       height = 9,\n       units = \"in\",\n       dpi = 400)\nknitr::include_graphics(here::here(OUT_NOASSAY))"}]
